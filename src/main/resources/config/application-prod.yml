# ===================================================================
# Spring Boot configuration for the "prod" profile.
# ===================================================================

# ===================================================================
# Standard Spring Boot properties.
# ===================================================================

logging:
  level:
    ROOT: INFO
    tech.jhipster: INFO
    com.mycompany.myapp: INFO
    # DEBUG pour Liquibase en cas de problème de démarrage lent
    liquibase: INFO # Conservez WARN ou INFO. Si le problème persiste, passez à DEBUG.

management:
  security:
      enabled: false
  prometheus:
    metrics:
      export:
        enabled: false

spring:
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: org.postgresql.Driver # <-- NOUVEAU : Force l'utilisation du driver PostgreSQL
    # Retirer les paramètres user/password de l'URL. Nous allons les passer séparément.
    url: ${SPRING_DATASOURCE_URL} # Nous allons injecter l'URL PURE ici via env var
    username: ${SPRING_DATASOURCE_USERNAME} # <-- NOUVEAU : Utilisateur séparé
    password: ${SPRING_DATASOURCE_PASSWORD} # <-- NOUVEAU : Mot de passe séparé
    hikari:
      poolName: Hikari
      # ⚠️ IMPORTANT : Optimisation Hikari pour les connexions Cloud/Pooler Supabase
      maximum-pool-size: 10 # Augmenté légèrement pour un meilleur débit
      minimum-idle: 2 # Assure qu'un minimum de connexions est maintenu
      auto-commit: true # Remis à 'true' (plus sûr, surtout pour Liquibase)
      connection-timeout: 30000 # 30 secondes pour établir une connexion
      validation-timeout: 5000 # 5 secondes pour valider une connexion
      max-lifetime: 1800000 # 30 minutes (30 * 60 * 1000 ms) pour éviter les connexions mortes du pooler
      idle-timeout: 600000 # 10 minutes (10 * 60 * 1000 ms) avant d'expirer une connexion inactive
  # Replace by 'prod, faker' to add the faker context and have sample data loaded in production
  liquibase:
    contexts: prod
  mail:
    host: localhost
    port: 25
    username:
    password:
  thymeleaf:
    cache: true

stripe:
  secret-key: ${STRIPE_SECRET_KEY} # Utilisation du format ${VARIABLE} pour les variables d'environnement
# ===================================================================
# Server configuration
# ===================================================================
server:
  port: 80
  address: 0.0.0.0
  shutdown: graceful # see https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-graceful-shutdown
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,application/javascript,application/json,image/svg+xml
    min-response-size: 1024

# ===================================================================
# JHipster specific properties
# ===================================================================

jhipster:
  http:
    cache: # Used by the CachingHttpHeadersFilter
      timeToLiveInDays: 1461
  cache: # Cache configuration
    ehcache: # Ehcache configuration
      time-to-live-seconds: 3600 # By default objects stay 1 hour in the cache
      max-entries: 1000 # Number of objects in each cache entry
  security:
    authentication:
      # NOUVELLE LIGNE : Désactive l'exigence d'activation (et l'envoi d'e-mail)
      #account-activation-required: false
      jwt:
        # Assurez-vous que cette clé n'est PAS stockée en clair dans ce fichier pour la production
        # Elle DOIT être injectée via une variable d'environnement ou un service de configuration sécurisé.
        base64-secret: ZDk1MmY1NTNiZTM4MDBiY2I0Zjc1M2JjMTBhNTAwYTk4ZWYwOGJkYjhhYjIzYjkzZDJiOTVmMjUwYjdjZWE5ODM1OTI1MjY1MWZhODQzMDU1NGY0YTMyZDNhMTRlNGRlY2ZiYjc3YmM2ZWMzYzg2MzZiMzNmMTMwYmVmYmE4MDg=
        # Token is valid 24 hours
        token-validity-in-seconds: 86400
        token-validity-in-seconds-for-remember-me: 2592000
  mail: # specific JHipster mail property
    # Vous avez retiré l'URL, ce qui est logique si la fonction mail est désactivée.
    # Base-url est maintenant vide.
    base-url:
  logging:
    use-json-format: false # By default, logs are not in Json format
    logstash: # Forward logs to logstash over a socket, used by LoggingConfiguration
      enabled: false
      host: localhost
      port: 5000
      ring-buffer-size: 512
# ===================================================================
# Application specific properties
# ===================================================================

# application:
