@if (isConnected) {
  <button class="back-button" (click)="goback()"><i class="fa-solid fa-reply"></i> Retour aux produits</button>

  <div class="tcg-product-wrapper">
    <div class="tcg-card-frame">
      <div class="tcg-title-banner">
        <h1>{{ product.name }}</h1>
      </div>

      <div class="tcg-card-inner">
        <div class="tcg-image-zone">
          <div class="tcg-image-frame" (mousemove)="handleMouseMove($event)" (mouseleave)="showZoom = false">
            @if (images.length > 1) {
              <button class="tcg-carousel-btn left no-zoom" (click)="prevImage()">&#10094;</button>
            }

            <img [src]="images[currentIndex]" class="tcg-image" alt="img" />

            @if (images.length > 1) {
              <button class="tcg-carousel-btn right no-zoom" (click)="nextImage()">&#10095;</button>
            }

            <div class="foil-overlay"></div>
          </div>
        </div>

        <div class="tcg-info-zone">
          @if (!showZoom) {
            <div class="tcg-details-panel">
              <p class="tcg-desc">{{ product.desc }}</p>

              <!-- Tags -->
              @if (tags.length > 0) {
                <div class="tcg-tags-block">
                  <span class="tcg-tags-label">Associated tags:</span>

                  <div class="tcg-tags">
                    @for (tag of tags; track tag.id) {
                      <app-tag-label [tag]="tag" (click)="onTagClicked(tag.id)"></app-tag-label>
                    }
                  </div>
                </div>
              }

              <p class="tcg-price">{{ product.price }} €</p>

              <p class="tcg-stock" [class.out]="(product.quantity ?? 0) <= 0">
                {{ (product.quantity ?? 0) > 0 ? 'En stock : ' + product.quantity : 'Rupture de stock' }}
              </p>

              <button
                class="tcg-add-button"
                id="addButton"
                (click)="addToCart(product.id)"
                [disabled]="(product.quantity ?? 0) === 0 || maxStock"
              >
                @if (maxStock) {
                  Stock épuisé
                } @else {
                  Ajouter au panier
                }
              </button>
              @if (product.id !== -1) {
                <jhi-comment class="tcg-comment-button" [productId]="product.id"></jhi-comment>
              }
            </div>
            <div class="notif-container">
              @for (msg of successMessages; track msg) {
                <div class="feedback-message">
                  <i class="fa-solid fa-circle-check"></i>
                  {{ msg }}
                </div>
              }
            </div>
          } @else {
            <div class="tcg-zoom-panel">
              <div
                class="tcg-zoom-image"
                [ngStyle]="{
                  'background-image': 'url(' + images[currentIndex] + ')',
                  'background-position': backgroundPosition,
                  'background-size': zoomLevel + '%',
                }"
              ></div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
  <!-- Show similar products for both connected and not connected users -->
  @if (alikeProducts.length > 0) {
    <div class="alike-products-section">
      <h1 class="alike-title">Produits similaires:</h1>
      <div class="alike-products-grid">
        @for (p of alikeProducts; track p.id) {
          <jhi-mini-fiche [idProduit]="p.id"></jhi-mini-fiche>
        }
      </div>
    </div>
  }
} @else {
  <jhi-login redirectUrl="/fiche_produit/{{ product.id }}"></jhi-login>
}
