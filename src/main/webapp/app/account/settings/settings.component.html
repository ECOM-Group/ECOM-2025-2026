<div class="tcg-profile-wrapper">

  <div class="tcg-card-frame">

    <!-- BANDEAU TITRE -->
    <div class="tcg-title-banner">
      <h2>
        Profil de <strong>{{ settingsForm.value.login }}</strong>
      </h2>
    </div>

    <!-- Succès -->
    @if (success()) {
      <div class="tcg-success-msg">
        Votre profil a été sauvegardé !
      </div>
    }

    <jhi-alert-error />

    <form name="form" (ngSubmit)="save()" [formGroup]="settingsForm" novalidate>

     

      <div class="tcg-section">

        <div class="tcg-input-row">
          <label for="lastName">Nom</label>
          <input
            id="lastName"
            type="text"
            formControlName="lastName"
            placeholder="Dupont"
            class="tcg-input"
          />
        </div>

        @let lastNameRef = settingsForm.get('lastName')!;
        @if (lastNameRef.invalid && (lastNameRef.dirty || lastNameRef.touched)) {
          <div class="tcg-error-message">
            @if (lastNameRef?.errors?.required) { Votre nom est requis. }
            @if (lastNameRef?.errors?.minlength) { Votre nom doit contenir au moins 1 caractère. }
            @if (lastNameRef?.errors?.maxlength) { Votre nom doit contenir max 50 caractères. }
          </div>
        }

        <div class="tcg-input-row">
          <label for="firstName">Prénom</label>
          <input
            id="firstName"
            type="text"
            formControlName="firstName"
            placeholder="Jean"
            class="tcg-input"
          />
        </div>

        @let firstNameRef = settingsForm.get('firstName')!;
        @if (firstNameRef.invalid && (firstNameRef.dirty || firstNameRef.touched)) {
          <div class="tcg-error-message">
            @if (firstNameRef?.errors?.required) { Prénom requis. }
            @if (firstNameRef?.errors?.minlength) { Min. 1 caractère. }
            @if (firstNameRef?.errors?.maxlength) { Max. 50 caractères. }
          </div>
        }

        <div class="tcg-input-row">
          <label for="email">Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="exemple@gmail.com"
            class="tcg-input"
          />
        </div>

        @let emailRef = settingsForm.get('email')!;
        @if (emailRef.invalid && (emailRef.dirty || emailRef.touched)) {
          <div class="tcg-error-message">
            @if (emailRef?.errors?.required) { Email requis. }
            @if (emailRef?.errors?.email) { Email invalide. }
            @if (emailRef?.errors?.minlength) { Min. 5 caractères. }
            @if (emailRef?.errors?.maxlength) { Max. 50 caractères. }
          </div>
        }

        <!-- LANGUE -->
        @if (languages && languages.length > 0) {
          <div class="tcg-input-row">
            <label for="langKey">Langue</label>
            <select id="langKey" class="tcg-input" formControlName="langKey">
              @for (language of languages; track $index) {
                <option [value]="language">
                  {{ language | findLanguageFromKey }}
                </option>
              }
            </select>
          </div>
        }

      </div>

      <div class="tcg-section">

        <h3 class="tcg-subtitle">Mes adresses</h3>

        @if (addressesArray && addressesArray.length > 0) {

          @for (addr of addressesArray.controls; track $index) {

            <div
              [formGroup]="getAddressFormGroup(addr)"
              class="tcg-address-card"
            >

              <div class="tcg-address-actions">
                <button type="button" class="tcg-btn small" (click)="resetAddress($index)">Reset</button>

                <button
                  type="button"
                  class="tcg-btn delete small"
                  (click)="toggleDelete($index)"
                >
                  @if (addr.get('deleted')?.value) { Restaurer } @else { Supprimer }
                </button>
              </div>

              <div class="tcg-input-row">
                <label>Pays</label>
                <input type="text" class="tcg-input" formControlName="country" (input)="markModified($index, 'country')" />
              </div>

              <div class="tcg-input-row">
                <label>Ville</label>
                <input type="text" class="tcg-input" formControlName="city" (input)="markModified($index, 'city')" />
              </div>

              <div class="tcg-input-row">
                <label>Rue</label>
                <input type="text" class="tcg-input" formControlName="street" (input)="markModified($index, 'street')" />
              </div>

              <div class="tcg-input-row">
                <label>Code postal</label>
                <input type="text" class="tcg-input" formControlName="zipcode" (input)="markModified($index, 'zipcode')" />
              </div>

              @if (addr.get('modified')?.value) {
                <div class="tcg-modified-badge">Modifié</div>
              }

            </div>

          }
        } @else {
          <div class="tcg-info-msg">Aucune adresse enregistrée</div>
        }

        <button type="button" class="tcg-btn add" (click)="addAddress()">
          Ajouter une adresse
        </button>

      </div>

      <button
        type="submit"
        class="tcg-btn primary big"
        [disabled]="settingsForm.invalid"
      >
        Sauvegarder
      </button>

    </form>

  </div>

</div>
